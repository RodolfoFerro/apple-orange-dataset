# -*- coding: utf-8 -*-
"""script

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1xLLlh0fHvMe7P5yiJYqN81vriYAra-qk
"""

!git clone https://github.com/RodolfoFerro/apple-orange-dataset.git

# Commented out IPython magic to ensure Python compatibility.
# %cd apple-orange-dataset
!ls

!pip install extcolors -q

from glob import glob

from tqdm import tqdm
import pandas as pd
import numpy as np
import extcolors
import PIL
import cv2


# Load paths from images
a_training_files = sorted(glob('train/apples/*.jpg'))
o_training_files = sorted(glob('train/oranges/*.jpg'))
a_testing_files = sorted(glob('test/apples/*.jpg'))
o_testing_files = sorted(glob('test/oranges/*.jpg'))


# Print image count
print("Apple training images:", len(a_training_files))
print("Apple testing images:", len(a_testing_files))
print("Orange training images:", len(o_training_files))
print("Orange testing images:", len(o_testing_files))


# Process training data
training_data = []

print('Processing apple files (training)...')
for apple_file in tqdm(a_training_files):
    img = cv2.imread(apple_file)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    img = PIL.Image.fromarray(np.uint8(img))
    colors, pixel_count = extcolors.extract_from_image(img)
    training_data.append([apple_file, colors[0][0], 0])

print('Processing orange files (training)...')
for orange_file in tqdm(o_training_files):
    img = cv2.imread(orange_file)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    img = PIL.Image.fromarray(np.uint8(img))
    colors, pixel_count = extcolors.extract_from_image(img)
    training_data.append([orange_file, colors[0][0], 1])

training_df = pd.DataFrame(training_data, columns=['filename', 'color', 'class'])
training_df.to_csv('training_data.csv')


# Process testing data
testing_data = []

print('Processing apple files (testing)...')
for apple_file in tqdm(a_testing_files):
    img = cv2.imread(apple_file)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    img = PIL.Image.fromarray(np.uint8(img))
    colors, pixel_count = extcolors.extract_from_image(img)
    testing_data.append([apple_file, colors[0][0], 0])

print('Processing orange files (testing)...')
for orange_file in tqdm(o_testing_files):
    img = cv2.imread(orange_file)
    img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
    img = PIL.Image.fromarray(np.uint8(img))
    colors, pixel_count = extcolors.extract_from_image(img)
    testing_data.append([orange_file, colors[0][0], 1])

testing_df = pd.DataFrame(testing_data, columns=['filename', 'color', 'class'])
testing_df.to_csv('testing_data.csv')